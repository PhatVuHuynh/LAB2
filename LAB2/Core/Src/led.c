/*
 * led.c
 *
 *  Created on: Oct 23, 2023
 *      Author: ADMIN
 */

#include "led.h"
#include "main.h"

const uint8_t chu_cai[208] = { 0x18, 0x24, 0x42, 0x42, 0x7e, 0x42, 0x42, 0x42, //A
		0x7c, 0x42, 0x42, 0x7c, 0x42, 0x42, 0x42, 0x7c, //B
		0x3c, 0x42, 0x40, 0x40, 0x40, 0x40, 0x42, 0x3c, //C
		0x78, 0x44, 0x42, 0x42, 0x42, 0x42, 0x44, 0x78, //D
		0x7e, 0x40, 0x40, 0x7e, 0x40, 0x40, 0x40, 0x7e, //E
		0x7e, 0x40, 0x40, 0x7e, 0x40, 0x40, 0x40, 0x40, //F
		0x38, 0x44, 0x40, 0x40, 0x4e, 0x44, 0x44, 0x38, //G
		0x42, 0x42, 0x42, 0x7e, 0x42, 0x42, 0x42, 0x42, //H
		0x7e, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0x7e, //I
		0x7e, 0x08, 0x08, 0x08, 0x08, 0x08, 0x48, 0x30, //J
		0x42, 0x44, 0x48, 0x70, 0x70, 0x48, 0x44, 0x42, //K
		0x60, 0x60, 0x60, 0x60, 0x60, 0x60, 0x60, 0x7e, //L
		0x42, 0x66, 0x5a, 0x5a, 0x42, 0x42, 0x42, 0x42, //M
		0x42, 0x62, 0x72, 0x7a, 0x5e, 0x4e, 0x46, 0x42, //N
		0x3c, 0x42, 0x42, 0x42, 0x42, 0x42, 0x42, 0x3c, //O
		0x7c, 0x42, 0x42, 0x42, 0x7c, 0x40, 0x40, 0x40, //P
		0x18, 0x24, 0x42, 0x42, 0x42, 0x4a, 0x24, 0x1a, //Q
		0x78, 0x44, 0x44, 0x78, 0x70, 0x48, 0x44, 0x42, //R
		0x3c, 0x42, 0x40, 0x30, 0x18, 0x06, 0x42, 0x3c, //S
		0x7e, 0x7e, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18, //T
		0x42, 0x42, 0x42, 0x42, 0x42, 0x42, 0x42, 0x3c, //U
		0x42, 0x42, 0x42, 0x42, 0x42, 0x66, 0x3c, 0x18, //V
		0x42, 0x42, 0x42, 0x42, 0x5a, 0x5a, 0x66, 0x42, //W
		0x42, 0x66, 0x24, 0x18, 0x18, 0x24, 0x66, 0x42, //X
		0x42, 0x42, 0x42, 0x24, 0x18, 0x18, 0x18, 0x18, //Y
		0x7e, 0x02, 0x04, 0x08, 0x10, 0x20, 0x40, 0x7e //Z
		};

/*void initLED8x8(struct led8x8 *led, GPIO_TypeDef *gpio_col, uint16_t pin_c0,
		uint16_t pin_c1, uint16_t pin_c2, uint16_t pin_c3, uint16_t pin_c4,
		uint16_t pin_c5, uint16_t pin_c6, uint16_t pin_c7,
		GPIO_TypeDef *gpio_row, uint16_t pin_r0, uint16_t pin_r1,
		uint16_t pin_r2, uint16_t pin_r3, uint16_t pin_r4, uint16_t pin_r5,
		uint16_t pin_r6, uint16_t pin_r7, uint8_t *buffer) {
	led->gpio_col = gpio_col;
	led->gpio_row = gpio_row;
	led->pin_c0 = pin_c0;
	led->pin_c1 = pin_c1;
	led->pin_c2 = pin_c2;
	led->pin_c3 = pin_c3;
	led->pin_c4 = pin_c4;
	led->pin_c5 = pin_c5;
	led->pin_c6 = pin_c6;
	led->pin_c7 = pin_c7;
	led->pin_r0 = pin_r0;
	led->pin_r1 = pin_r1;
	led->pin_r2 = pin_r2;
	led->pin_r3 = pin_r3;
	led->pin_r4 = pin_r4;
	led->pin_r5 = pin_r5;
	led->pin_r6 = pin_r6;
	led->pin_r7 = pin_r7;
	led->buffer = buffer;
}*/

void OffAllLed() {
	uint16_t pin = row0_Pin | row1_Pin | row2_Pin | row3_Pin
			| row4_Pin | row5_Pin | row6_Pin | row7_Pin;
	HAL_GPIO_WritePin(GPIOB, pin, 1);
}

void OnColunm(uint8_t buffer) {
	uint8_t mask = 0x01;
	for (int i = 7; i >= 0; i--) {
		switch (i) {
		case 0:
			HAL_GPIO_WritePin(GPIOA, enm7_Pin,
					(mask << i & buffer));
			break;
		case 1:
			HAL_GPIO_WritePin(GPIOA, enm6_Pin,
					(mask << i & buffer));
			break;
		case 2:
			HAL_GPIO_WritePin(GPIOA, enm5_Pin,
					(mask << i & buffer));
			break;
		case 3:
			HAL_GPIO_WritePin(GPIOA, enm4_Pin,
					(mask << i & buffer));
			break;
		case 4:
			HAL_GPIO_WritePin(GPIOA, enm3_Pin,
					(mask << i & buffer));
			break;
		case 5:
			HAL_GPIO_WritePin(GPIOA, enm2_Pin,
					(mask << i & buffer));
			break;
		case 6:
			HAL_GPIO_WritePin(GPIOA, enm1_Pin,
					(mask << i & buffer));
			break;
		default:
			HAL_GPIO_WritePin(GPIOA, enm0_Pin,
					(mask << i & buffer));
		}
	}
}

void updateLEDMatrix(uint8_t *buffer, int index){
	OffAllLed();
	switch (index) {
	case 0:
		HAL_GPIO_WritePin(GPIOB, row0_Pin, 0);
		break;
	case 1:
		HAL_GPIO_WritePin(GPIOB, row1_Pin, 0);
		break;
	case 2:
		HAL_GPIO_WritePin(GPIOB, row2_Pin, 0);
		break;
	case 3:
		HAL_GPIO_WritePin(GPIOB, row3_Pin, 0);
		break;
	case 4:
		HAL_GPIO_WritePin(GPIOB, row4_Pin, 0);
		break;
	case 5:
		HAL_GPIO_WritePin(GPIOB, row5_Pin, 0);
		break;
	case 6:
		HAL_GPIO_WritePin(GPIOB, row6_Pin, 0);
		break;
	case 7:
		HAL_GPIO_WritePin(GPIOB, row7_Pin, 0);
		break;
	default:
		return;
	}

	OnColunm(buffer[index]);
}

void shiftLeft(uint8_t *buffer){
	for(int i = 0; i < 8; ++i){
		uint8_t check = 0x80 & buffer[i];
		buffer[i] <<= 1;
		if(check == 0x80){
			buffer[i] |= 1;
		}
	}
}
